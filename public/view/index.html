<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Smolville</title>
  <script type="text/javascript"
    src="/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=y2nkKUdBhQRn4lwmDhvhXpagFzac1RqZxNYeQSkOYFhL8CPZQEayDML2dhHcnGlpmVJU59N1jsvP0WuK1DWGbqRjfQ6ACVbFSDBVLWCmIoDpflmemaWarVWa1o-sX3148aQArn1QGVV7oeJ1i-WGkfUblOFo1UeT70_RZUg5CsWGx6DWU94CBVAC5PcmCpWW7vqNUWox7dOdt3gX98WtwpJzVMvKM3JOnJQu-9vd75aDDAXFCesmfKEt3-enqOIdJq_qjA1mgcKgqrzwKuSZC5nE2kwvOINV3Gjltl4RUX4"
    charset="UTF-8"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      color: #fff;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      padding-bottom: 80px;
      overflow-x: hidden;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
    }

    /* === –ë–ï–ô–î–ñ –£–ß–ê–°–¢–ù–ò–ö–û–í === */
    .attendees-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: rgba(0, 255, 204, 0.9);
      color: #000;
      padding: 6px 10px;
      border-radius: 14px;
      font-size: 11px;
      font-weight: 700;
      z-index: 2;
      backdrop-filter: blur(4px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }

      100% {
        transform: scale(1);
      }
    }

    /* === –õ–û–ì–û–¢–ò–ü === */
    .logo {
      text-align: center;
      margin: 16px 0 20px;
    }

    .logo img {
      height: 60px;
      width: auto;
      object-fit: contain;
    }

    /* === –ù–ê–í–ò–ì–ê–¶–ò–Ø –° –ò–ö–û–ù–ö–ê–ú–ò === */
    .nav {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding: 0 4px;
      scrollbar-width: none;
      justify-content: center;
    }

    .nav::-webkit-scrollbar {
      display: none;
    }

    .nav button {
      padding: 12px;
      background: #1a1a1a;
      border: none;
      color: #888;
      border-radius: 16px;
      font-size: 14px;
      font-weight: 500;
      white-space: nowrap;
      transition: all 0.3s ease;
      min-width: 60px;
      height: 60px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
    }

    .nav button.active {
      background: #fff;
      color: #000;
      font-weight: 600;
    }

    .nav-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .nav-text {
      font-size: 11px;
      font-weight: 500;
    }

    /* === –í–ö–õ–ê–î–ö–ò === */
    .tabs {
      display: flex;
      background: #1a1a1a;
      border-radius: 25px;
      padding: 4px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .tab {
      flex: 1;
      padding: 11px 0;
      text-align: center;
      font-size: 15px;
      font-weight: 500;
      color: #888;
      transition: color 0.3s ease;
      position: relative;
      z-index: 2;
      cursor: pointer;
    }

    .tab.active {
      color: #000;
      font-weight: 600;
    }

    .tab-indicator {
      position: absolute;
      bottom: 4px;
      left: 4px;
      width: calc(50% - 8px);
      height: calc(100% - 8px);
      background: #fff;
      border-radius: 21px;
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 1;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    /* === –ö–ê–†–¢–û–ß–ö–ò –°–û–ë–´–¢–ò–ô === */
    .event-card {
      background: #1a1a1a;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 16px;
      position: relative;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .event-card:hover {
      transform: translateY(-2px);
    }

    .event-img-wrapper {
      position: relative;
      height: 180px;
      overflow: hidden;
    }

    .event-img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .event-card:hover .event-img {
      transform: scale(1.03);
    }

    .gradient-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 100%;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 50%, transparent 100%);
      pointer-events: none;
      z-index: 1;
    }

    .favorite {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      z-index: 2;
    }

    .favorite.active {
      background: #fff;
    }

    .favorite svg {
      width: 18px;
      height: 18px;
      fill: #fff;
      transition: fill 0.3s ease;
    }

    .favorite.active svg {
      fill: #000;
    }

    .event-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px;
      z-index: 2;
    }

    .event-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
      line-height: 1.3;
    }

    .event-tag {
      display: inline-block;
      background: #e91e63;
      color: #fff;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .event-date {
      font-size: 13px;
      color: #ccc;
      font-weight: 500;
    }

    /* === –ö–ê–†–¢–û–ß–ö–ò –ì–û–õ–û–°–û–í–ê–ù–ò–ô === */
    .voting-card {
      background: #1a1a1a;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      position: relative;
      border-left: 4px solid #00ffcc;
      cursor: pointer;
    }

    .voting-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(0, 255, 204, 0.2);
      color: #00ffcc;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .voting-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .voting-description {
      color: #ccc;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .voting-status {
      color: #00ffcc;
      font-size: 12px;
      font-weight: 600;
    }

    .voting-card.completed {
      border-left-color: #666;
      opacity: 0.7;
    }

    .voting-card.completed .voting-badge {
      background: rgba(102, 102, 102, 0.2);
      color: #888;
    }

    .voting-card.completed .voting-status {
      color: #888;
    }

    /* === –ö–ê–†–¢–û–ß–ö–ò –†–ï–ö–õ–ê–ú–´ === */
    .ad-card {
      background: #1a1a1a;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px;
      position: relative;
      border-left: 4px solid #ff00cc;
      cursor: pointer;
    }

    .ad-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255, 0, 204, 0.2);
      color: #ff00cc;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }

    /* === –†–ê–ó–î–ï–õ–´ (–°–æ–±—ã—Ç–∏—è, –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è, –ú–∞—Ä–∫–µ—Ç, –ê–∫–∫–∞—É–Ω—Ç) === */
    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* === –ó–ê–ì–õ–£–®–ö–ò === */
    .placeholder-section {
      text-align: center;
      padding: 60px 20px;
      color: #888;
    }

    .placeholder-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .placeholder-text {
      font-size: 16px;
      margin-bottom: 8px;
    }

    .placeholder-subtext {
      font-size: 14px;
      color: #666;
    }

    /* === –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê === */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: #1a1a1a;
      border-radius: 20px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: #888;
      font-size: 24px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .modal-subtitle {
      color: #888;
      font-size: 14px;
      margin-bottom: 16px;
    }

    .modal-image {
      width: 100%;
      height: auto;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 16px;
    }

    .modal-description {
      color: #ccc;
      line-height: 1.5;
      margin-bottom: 20px;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .btn {
      flex: 1;
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #fff;
      color: #000;
    }

    .btn-secondary {
      background: #333;
      color: #fff;
    }

    /* === –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ === */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #000;
      border-top: 1px solid #222;
      display: flex;
      justify-content: space-around;
      padding: 12px 0 16px;
      z-index: 100;
    }

    .bottom-nav button {
      background: none;
      border: none;
      color: #666;
      font-size: 11px;
      font-weight: 500;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: color 0.3s ease;
      padding: 4px;
      cursor: pointer;
    }

    .bottom-nav button.active {
      color: #fff;
    }

    .bottom-nav svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }

    /* === –°–ö–ï–õ–ï–¢–û–ù-–ó–ê–ì–†–£–ó–ß–ò–ö === */
    .skeleton {
      background: #2a2a2a;
      border-radius: 16px;
      margin-bottom: 16px;
      overflow: hidden;
      position: relative;
    }

    .skeleton::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transform: translateX(-100%);
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      animation: loading 1.5s infinite;
    }

    .skeleton-card {
      height: 200px;
    }

    @keyframes loading {
      100% {
        transform: translateX(100%);
      }
    }

    /* === –£–¢–ò–õ–ò–¢–´ === */
    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>

  <div class="container">
    <!-- –õ–û–ì–û–¢–ò–ü -->
    <div class="logo">
      <img src="logo.PNG" alt="–°–º–æ–∫ –í–∏–ª–ª–µ" onerror="this.style.display='none'">
    </div>

    <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø –° –ò–ö–û–ù–ö–ê–ú–ò -->
    <div class="nav" id="eventsNav">
      <button class="active" data-filter="all">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
          </svg>
        </div>
        <div class="nav-text">–í—Å–µ</div>
      </button>
      <button data-filter="–°–ø–æ—Ä—Ç">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor"
              d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z" />
          </svg>
        </div>
        <div class="nav-text">–°–ø–æ—Ä—Ç</div>
      </button>
      <button data-filter="–í—ã—Å—Ç–∞–≤–∫–∏">
        <div class="nav-icon">
          <svg viewBox="0 0 24 24" width="20" height="20">
            <path fill="currentColor"
              d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
          </svg>
        </div>
        <div class="nav-text">–í—ã—Å—Ç–∞–≤–∫–∏</div>
      </button>
    </div>

    <!-- –í–ö–õ–ê–î–ö–ò -->
    <div class="tabs" id="eventsTabs">
      <div class="tab active" data-tab="future">–ë—É–¥—É—â–∏–µ</div>
      <div class="tab" data-tab="past">–ü—Ä–æ—à–µ–¥—à–∏–µ</div>
      <div class="tab-indicator"></div>
    </div>

    <!-- –†–ê–ó–î–ï–õ: –°–û–ë–´–¢–ò–Ø -->
    <div id="events-section" class="section active">
      <div id="events-container">
        <!-- –°–∫–µ–ª–µ—Ç–æ–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ -->
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
      </div>
    </div>

    <!-- –†–ê–ó–î–ï–õ: –í–°–¢–†–ï–ß–ò -->
    <div id="meetings-section" class="section">
      <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –≤—Å—Ç—Ä–µ—á–∏ -->
      <div class="create-meeting-btn-container" style="margin-bottom: 20px;">
        <button class="btn btn-primary" id="createMeetingBtn"
          style="width: 100%; background: #10b981; border: none; padding: 14px; border-radius: 12px;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"
            style="margin-right: 8px; vertical-align: middle;">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
          –°–æ–∑–¥–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É
        </button>
      </div>

      <div id="meetings-container">
        <!-- –°–∫–µ–ª–µ—Ç–æ–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ -->
        <div class="skeleton skeleton-card"></div>
        <div class="skeleton skeleton-card"></div>
      </div>
    </div>

    <!-- –†–ê–ó–î–ï–õ: –ú–ê–†–ö–ï–¢ (–∑–∞–≥–ª—É—à–∫–∞) -->
    <div id="market-section" class="section">
      <div class="placeholder-section">
        <div class="placeholder-icon">üõí</div>
        <div class="placeholder-text">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</div>
        <div class="placeholder-subtext">–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –º–∞–≥–∞–∑–∏–Ω –º–µ—Ä—á–∞ –∏ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–µ–π</div>
      </div>
    </div>

    <!-- –†–ê–ó–î–ï–õ: –ê–ö–ö–ê–£–ù–¢ (–∑–∞–≥–ª—É—à–∫–∞) -->
    <div id="account-section" class="section">
      <div class="placeholder-section">
        <div class="placeholder-icon">üë§</div>
        <div class="placeholder-text">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
        <div class="placeholder-subtext">–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ—Ñ–∏–ª–µ–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏</div>
      </div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–ë–´–¢–ò–Ø -->
  <div id="eventModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('eventModal')">√ó</button>
      <h2 class="modal-title" id="eventModalTitle">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
      <div class="modal-subtitle">
        <span id="eventModalDate">–î–∞—Ç–∞</span> ‚Ä¢ <span id="eventModalLocation">–ú–µ—Å—Ç–æ</span>
      </div>
      <img id="eventModalImage" class="modal-image" src="" alt="">
      <p class="modal-description" id="eventModalDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</p>

      <div class="modal-actions">
        <button class="btn btn-secondary" id="eventMapBtn" style="display: none;">–ù–∞ –∫–∞—Ä—Ç–µ</button>
        <button class="btn btn-primary" id="eventAttendBtn">–Ø –ø–æ–π–¥—É!</button>
      </div>

      <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #333;">
        <span style="color: #888; font-size: 14px;">
          –ò–¥—É—Ç: <span id="eventAttendeesCount">0</span> —á–µ–ª–æ–≤–µ–∫
        </span>
      </div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –°–û–ó–î–ê–ù–ò–Ø –í–°–¢–†–ï–ß–ò -->
  <div id="createMeetingModal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <button class="modal-close" onclick="closeModal('createMeetingModal')">√ó</button>

      <h2 class="modal-title">–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –≤—Å—Ç—Ä–µ—á–∏</h2>

      <form id="createMeetingForm" enctype="multipart/form-data">
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–ù–∞–∑–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏
            *</label>
          <input type="text" name="title" required maxlength="256" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏"
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
          <textarea name="description" required maxlength="1024" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –≤—Å—Ç—Ä–µ—á—É..."
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px; resize: vertical;"></textarea>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è *</label>
          <input type="datetime-local" name="date" required
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏ *</label>
          <select name="type" required
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
            <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
            <option value="–ö–∞–ª—å—è–Ω–Ω–∞—è –∫–æ–º–∞–Ω–∏">–ö–∞–ª—å—è–Ω–Ω–∞—è –∫–æ–º–∞–Ω–∏</option>
            <option value="–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞">–ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞</option>
            <option value="–ü–æ–∫–∞—Ç—É—à–∫–∏">–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–∞—è</option>
            <option value="–ë–æ–ª—å—à–∞—è –∫–æ–º–ø–∞–Ω–∏—è">–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è</option>
            <option value="–§–∞–Ω –≤—Å—Ç—Ä–µ—á–∞">–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ
            –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</label>
          <input type="number" name="age_limit" min="0" max="40" placeholder="0 (–±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π)"
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è
            *</label>
          <input type="text" name="location" required maxlength="256" placeholder="–£–∫–∞–∂–∏—Ç–µ –º–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏"
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
        </div>

        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É</label>
          <input type="url" name="map_link" maxlength="512" placeholder="https://maps.google.com/..."
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
        </div>

        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #e5e7eb;">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            –≤—Å—Ç—Ä–µ—á–∏</label>
          <input type="file" name="image" accept="image/*"
            style="width: 100%; padding: 12px; border: 1px solid #4b5563; border-radius: 8px; background: #1f2937; color: #f9fafb; font-size: 14px;">
          <div id="imagePreview" style="margin-top: 10px; display: none;">
            <img id="previewImg"
              style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #4b5563;">
          </div>
        </div>

        <div class="modal-actions" style="margin-top: 24px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('createMeetingModal')"
            style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary" id="submitMeetingBtn" style="flex: 1; background: #10b981;">
            –°–æ–∑–¥–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ì–û–õ–û–°–û–í–ê–ù–ò–Ø -->
  <div id="votingModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('votingModal')">√ó</button>
      <h2 class="modal-title" id="votingModalTitle">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h2>
      <p class="modal-description" id="votingModalDescription">–û–ø–∏—Å–∞–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è</p>

      <div id="votingLocationSection">
        <p style="color: #888; font-size: 14px; margin-bottom: 12px;">
          –î–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ä–∞–¥–∏—É—Å–µ 1000–º –æ—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –º–µ—Å—Ç–∞
        </p>
        <button class="btn btn-primary" id="getLocationBtn">–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
      </div>

      <div id="votingOptions" style="display: none; margin-top: 20px;">
        <h3 style="font-size: 16px; margin-bottom: 12px;">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç:</h3>
        <div id="votingOptionsList"></div>
      </div>

      <div id="votingResults" style="display: none; margin-top: 20px;">
        <h3 style="font-size: 16px; margin-bottom: 12px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
        <div id="votingResultsList"></div>
      </div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –†–ï–ö–õ–ê–ú–´ -->
  <div id="adModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('adModal')">√ó</button>
      <h2 class="modal-title" id="adModalTitle">–†–µ–∫–ª–∞–º–∞</h2>
      <p class="modal-description" id="adModalDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã</p>
      <img id="adModalImage" class="modal-image" src="" alt="">
      <button class="btn btn-primary" id="adModalButton" style="display: none;">–ü–µ—Ä–µ–π—Ç–∏</button>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –í–°–¢–†–ï–ß–ò -->
  <div id="meetingModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal('meetingModal')">√ó</button>

      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <h2 class="modal-title" id="meetingModalTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏</h2>
      <div class="modal-subtitle">
        <span id="meetingModalDate">–î–∞—Ç–∞</span> ‚Ä¢
        <span id="meetingModalLocation">–ú–µ—Å—Ç–æ</span> ‚Ä¢
        <span id="meetingModalAgeLimit">–í–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ</span>
      </div>

      <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
      <img id="meetingModalImage" class="modal-image" src="" alt="">

      <!-- –¢–∏–ø –∏ —Å—Ç–∞—Ç—É—Å -->
      <div class="modal-badges" style="display: flex; gap: 8px; margin-bottom: 16px;">
        <span class="event-tag" id="meetingModalType">–¢–ò–ü</span>
      </div>

      <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
      <p class="modal-description" id="meetingModalDescription">–û–ø–∏—Å–∞–Ω–∏–µ –≤—Å—Ç—Ä–µ—á–∏</p>

      <!-- –î–µ–π—Å—Ç–≤–∏—è -->
      <div class="modal-actions">
        <button class="btn btn-secondary" id="meetingMapBtn" style="display: none;">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px;">
            <path
              d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z" />
          </svg>
          –ù–∞ –∫–∞—Ä—Ç–µ
        </button>
        <button class="btn btn-primary" id="meetingAttendBtn">–Ø –ø–æ–π–¥—É!</button>
      </div>

      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
      <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #333;">
        <span style="color: #888; font-size: 14px;">
          –ò–¥—É—Ç: <span id="meetingAttendeesCount">0</span> —á–µ–ª–æ–≤–µ–∫
        </span>
      </div>

      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á) -->
      <div id="meetingVotingSection"
        style="display: none; margin-top: 20px; padding: 16px; background: rgba(59, 130, 246, 0.1); border-radius: 8px;">
        <h3 style="margin-bottom: 12px; font-size: 16px; color: #3b82f6;">–ê–∫—Ç–∏–≤–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ</h3>
        <p style="font-size: 14px; color: #888; margin-bottom: 12px;">–ü–æ—É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏–∏ –ø–æ–≤–µ—Å—Ç–∫–∏ –≤—Å—Ç—Ä–µ—á–∏</p>
        <button class="btn btn-outline" id="meetingVotingBtn" style="width: 100%;">
          –ü–µ—Ä–µ–π—Ç–∏ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é
        </button>
      </div>
    </div>
  </div>

  <!-- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ -->
  <div class="bottom-nav">
    <button class="active" data-section="events-section">
      <svg viewBox="0 0 24 24">
        <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" />
      </svg>
      <span>–°–æ–±—ã—Ç–∏—è</span>
    </button>
    <button data-section="meetings-section">
      <svg viewBox="0 0 24 24" width="20" height="20">
        <path fill="currentColor"
          d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63C19.68 7.55 18.92 7 18.06 7h-.12c-.86 0-1.63.55-1.9 1.37l-.86 2.58c1.08.6 1.82 1.73 1.82 3.05v8h3zm-7.5-10.5c.83 0 1.5-.67 1.5-1.5s-.67-1.5-1.5-1.5S11 9.17 11 10s.67 1.5 1.5 1.5zM5.5 6c1.11 0 2-.89 2-2s-.89-2-2-2-2 .89-2 2 .89 2 2 2zm2 16v-7H9V9c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v6h1.5v7h4zm6.5 0v-4h1v-4c0-.82-.68-1.5-1.5-1.5h-2c-.82 0-1.5.68-1.5 1.5v4h1v4h3z" />
      </svg>
      <span>–í—Å—Ç—Ä–µ—á–∏</span>
    </button>
    <button data-section="market-section">
      <svg viewBox="0 0 24 24">
        <path
          d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z" />
      </svg>
      <span>–ú–∞—Ä–∫–µ—Ç</span>
    </button>
    <button data-section="account-section">
      <svg viewBox="0 0 24 24">
        <path
          d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
      </svg>
      <span>–ê–∫–∫–∞—É–Ω—Ç</span>
    </button>
  </div>

  <script>
    //const BACKEND_URL = 'https://hundredtries.ru/smolville/server';
    const BACKEND_URL = 'http://127.0.0.1:8000';
    const tg = window.Telegram?.WebApp;

    if (!tg) {
      document.body.innerHTML = '<p class="text-center" style="padding: 20px; color: #fff;">–û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Telegram WebApp</p>';
      throw new Error('Telegram WebApp not found');
    }

    tg.ready();
    tg.expand();

    let currentEvents = [];
    let currentMeetings = [];
    let currentAds = [];
    let currentFilter = 'all';
    let currentTab = 'future';
    let currentSection = 'events-section';
    let userLocation = null;
    let currentEvent = null;
    let currentVoting = null;
    let currentAd = null;
    let serverAvailable = true;
    let serverStatusMessage = '';

    const user = tg.initDataUnsafe?.user || { id: 0, first_name: '–ì–æ—Å—Ç—å' };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function () {
      initNavigation();
      initTabs();
      initBottomNav();
      initCreateMeeting();
      loadData();
    });

    function initNavigation() {
      const navButtons = document.querySelectorAll('#eventsNav button');
      navButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          navButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          currentFilter = this.dataset.filter;
          if (currentSection === 'events-section') {
            renderEventsContent();
          }
        });
      });
    }

    function initTabs() {
      const tabs = document.querySelectorAll('#eventsTabs .tab');
      const indicator = document.querySelector('#eventsTabs .tab-indicator');

      tabs.forEach(tab => {
        tab.addEventListener('click', function () {
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          currentTab = this.dataset.tab;

          if (currentTab === 'future') {
            indicator.style.transform = 'translateX(0%)';
          } else {
            indicator.style.transform = 'translateX(100%)';
          }

          if (currentSection === 'events-section') {
            renderEventsContent();
          }
        });
      });
    }

    function initBottomNav() {
      const navButtons = document.querySelectorAll('.bottom-nav button');
      navButtons.forEach(btn => {
        btn.addEventListener('click', function () {
          navButtons.forEach(b => b.classList.remove('active'));
          this.classList.add('active');

          const sectionId = this.dataset.section;
          showSection(sectionId);
        });
      });
    }

    function initCreateMeeting() {
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      document.addEventListener('click', function (e) {
        if (e.target.id === 'createMeetingBtn' || e.target.closest('#createMeetingBtn')) {
          document.getElementById('createMeetingForm').reset();
          document.getElementById('imagePreview').style.display = 'none';
          document.querySelector('[name="date"]').value = getDefaultDateTime();
          openModal('createMeetingModal');
        }
      });

      // –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
      document.addEventListener('change', function (e) {
        if (e.target.name === 'image') {
          const file = e.target.files[0];
          const preview = document.getElementById('imagePreview');
          const previewImg = document.getElementById('previewImg');
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              previewImg.src = e.target.result;
              preview.style.display = 'block';
            }
            reader.readAsDataURL(file);
          } else {
            preview.style.display = 'none';
          }
        }
      });

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
      document.getElementById('createMeetingForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        const submitBtn = document.getElementById('submitMeetingBtn');
        const originalText = submitBtn.textContent;

        try {
          submitBtn.disabled = true;
          submitBtn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ...';

          const formData = new FormData(this);
          formData.append('user_id', user.id);

          const response = await fetch(BACKEND_URL + '/api/v1/meeting/create', {
            method: 'POST',
            body: formData
          });

          const result = await response.json();

          if (result.success) {
            showNotification('–í—Å—Ç—Ä–µ—á–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
            closeModal('createMeetingModal');
            loadData();
          } else {
            throw new Error(result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤—Å—Ç—Ä–µ—á–∏');
          }
        } catch (error) {
          showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      });
    }

    function getDefaultDateTime() {
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      return now.toISOString().slice(0, 16);
    }

    function showNotification(message, type) {
      const notification = document.createElement('div');
      notification.style.cssText = `
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    background: ${type === 'success' ? '#10b981' : '#ef4444'};
    color: white; padding: 12px 20px; border-radius: 8px;
    font-weight: 600; z-index: 10000;
  `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 3000);
    }

    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
    }

    function showSection(sectionId) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });

      document.getElementById(sectionId).classList.add('active');
      currentSection = sectionId;

      const eventsNav = document.getElementById('eventsNav');
      const eventsTabs = document.getElementById('eventsTabs');

      if (sectionId === 'events-section') {
        eventsNav.style.display = 'flex';
        eventsTabs.style.display = 'flex';
        renderEventsContent();
      } else {
        eventsNav.style.display = 'none';
        eventsTabs.style.display = 'none';

        if (sectionId === 'meetings-section') {
          renderMeetingsContent();
        }
      }
    }

    async function loadData() {
      try {
        const status = await fetch(`${BACKEND_URL}/api/STATUS`).then(r => r.json());

        if (status.availible === 0) {
          serverAvailable = false;
          serverStatusMessage = status.status || '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã';
          showServerError();
          return;
        } else {
          serverAvailable = true;
          serverStatusMessage = '';
        }

        // 3. –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
        const eventsPromise = fetch(`${BACKEND_URL}/api/v1/events`)
          .then(r => r.json())
          .catch(() => []);

        const adsPromise = fetch(`${BACKEND_URL}/api/v1/ads`)
          .then(r => r.json())
          .catch(() => []);

        const meetingsPromise = fetch(`${BACKEND_URL}/api/v1/meetings`)
          .then(r => r.json())
          .catch(() => []);

        // 4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—É—é –∑–∞–≥—Ä—É–∑–∫—É –æ—Ç–¥–µ–ª—å–Ω–æ
        // –°–Ω–∞—á–∞–ª–∞ —Å–æ–±—ã—Ç–∏—è (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
        eventsPromise.then(events => {
          currentEvents = Array.isArray(events) ? events : [];
      
          // –ï—Å–ª–∏ –º—ã —Å–µ–π—á–∞—Å –Ω–∞ —Å–µ–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π - –æ–±–Ω–æ–≤–ª—è–µ–º
          if (currentSection === 'events-section') {
            renderEventsContent();
          }
      
          // –£–≤–µ–¥–æ–º–ª—è–µ–º –æ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ–±—ã—Ç–∏–π
          onEventsLoaded();
        });

        // –ó–∞—Ç–µ–º –≤—Å—Ç—Ä–µ—á–∏
        meetingsPromise.then(meetings => {
          currentMeetings = Array.isArray(meetings) ? meetings : [];
      
          if (currentSection === 'meetings-section') {
            renderMeetingsContent();
          }
      
          onMeetingsLoaded();
        });

        // –í –∫–æ–Ω—Ü–µ —Ä–µ–∫–ª–∞–º–∞ (–º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
        adsPromise.then(ads => {
          currentAds = Array.isArray(ads) ? ads : [];
          onAdsLoaded();
        });

      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        serverAvailable = false;
        serverStatusMessage = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
        showServerError();
      }
    }

    function renderEventsContent() {
      const container = document.getElementById('events-container');

      if (!serverAvailable) {
        showServerError();
        return;
      }

      let filteredEvents = currentEvents.filter(event => {
        const eventDate = new Date(event.date);
        const now = new Date();

        if (currentTab === 'future') {
          if (eventDate < now) return false;
        } else if (currentTab === 'past') {
          if (eventDate >= now) return false;
        }

        if (currentFilter !== 'all' && event.type !== currentFilter) {
          return false;
        }

        return true;
      });

      filteredEvents.sort((a, b) => new Date(a.date) - new Date(b.date));

      const allItems = [];
      let adIndex = 0;

      filteredEvents.forEach((event, index) => {
        allItems.push({ type: 'event', data: event });

        if ((index + 1) % 2 === 0 && adIndex < currentAds.length) {
          allItems.push({ type: 'ad', data: currentAds[adIndex] });
          adIndex++;
        }
      });

      while (adIndex < currentAds.length) {
        allItems.push({ type: 'ad', data: currentAds[adIndex] });
        adIndex++;
      }

      container.innerHTML = '';

      if (allItems.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #888; padding: 40px 0;">–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
        return;
      }

      allItems.forEach(item => {
        if (item.type === 'event') {
          container.appendChild(createEventCard(item.data));
        } else if (item.type === 'ad') {
          container.appendChild(createAdCard(item.data));
        }
      });
    }

    function renderMeetingsContent() {
      const container = document.getElementById('meetings-container');

      if (!serverAvailable) {
        showServerError();
        return;
      }

      container.innerHTML = '';

      if (currentMeetings.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #888; padding: 40px 0;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á</p>';
        return;
      }

      currentMeetings.forEach(meeting => {
        container.appendChild(createMeetingCard(meeting));
      });
    }

    function createEventCard(event) {
      const div = document.createElement('div');
      div.className = 'event-card';

      const attendeesCount = event.attendees_count || 0;

      div.innerHTML =
        `
        <div class="event-img-wrapper">
          <img src="${event.image_url || 'https://via.placeholder.com/480x180/333/666?text=–°–æ–±—ã—Ç–∏–µ'}" 
               class="event-img" alt="${event.title}" loading="lazy">
          <div class="gradient-overlay"></div>
          <div class="favorite">
            <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
          </div>
          <!-- –ë–µ–π–¥–∂ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
          <div class="attendees-badge" style="
            position: absolute;
            top: 12px;
            left: 12px;
            ${getAttendeesBadgeStyle(attendeesCount)}
            padding: 6px 10px;
            border-radius: 14px;
            font-size: 11px;
            font-weight: 700;
            z-index: 2;
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            ${attendeesCount > 0 ? 'animation: pulse 2s infinite;' : ''}
          ">${attendeesCount} –∏–¥—É—Ç</div>
        </div>
        <div class="event-content">
          <div class="event-title">${event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
          <div class="event-tag">${event.type || '–°–û–ë–´–¢–ò–ï'}</div>
          <div class="event-date">${formatDate(event.date)}</div>
        </div>
     `;

      div.addEventListener('click', () => showEventModal(event));
      div.querySelector('.favorite').addEventListener('click', (e) => {
        e.stopPropagation();
        toggleFavorite(div.querySelector('.favorite'));
      });

      return div;
    }

    function getAttendeesBadgeStyle(count) {
      if (count === 0) {
        return 'background: rgba(255, 255, 255, 0.3); color: #fff;';
      } else if (count < 5) {
        return 'background: rgba(0, 255, 204, 0.9); color: #000;';
      } else if (count < 15) {
        return 'background: rgba(255, 152, 0, 0.9); color: #000;';
      } else {
        return 'background: rgba(233, 30, 99, 0.9); color: #fff;';
      }
    }

    function createMeetingCard(meeting) {
      const div = document.createElement('div');
      const isCompleted = meeting.status === 0;
      div.className = `event-card ${isCompleted ? 'completed' : ''}`;

      const attendeesCount = meeting.attendees_count || 0;

      div.innerHTML =
        `
    <div class="event-img-wrapper">
      <img src="${meeting.image_url || 'https://via.placeholder.com/480x180/333/666?text=–í—Å—Ç—Ä–µ—á–∞'}" 
           class="event-img" alt="${meeting.title}" loading="lazy">
      <div class="gradient-overlay"></div>
      <div class="favorite">
        <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
      </div>
      <!-- –ë–µ–π–¥–∂ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
      <div class="attendees-badge" style="
        position: absolute;
        top: 12px;
        left: 12px;
        ${getAttendeesBadgeStyle(attendeesCount)}
        padding: 6px 10px;
        border-radius: 14px;
        font-size: 11px;
        font-weight: 700;
        z-index: 2;
        backdrop-filter: blur(4px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        ${attendeesCount > 0 ? 'animation: pulse 2s infinite;' : ''}
      ">${attendeesCount} –∏–¥—É—Ç</div>
      <!-- –ë–µ–π–¥–∂ —Å—Ç–∞—Ç—É—Å–∞ –≤—Å—Ç—Ä–µ—á–∏ -->
      <div class="meeting-status-badge" style="
        position: absolute;
        top: 12px;
        right: 12px;
        background: ${isCompleted ? 'rgba(107, 114, 128, 0.9)' : 'rgba(59, 130, 246, 0.9)'};
        color: white;
        padding: 6px 10px;
        border-radius: 14px;
        font-size: 11px;
        font-weight: 700;
        z-index: 2;
        backdrop-filter: blur(4px);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      ">${isCompleted ? '–ó–ê–í–ï–†–®–ï–ù–û' : '–í–°–¢–†–ï–ß–ê'}</div>
    </div>
    <div class="event-content">
      <div class="event-title">${meeting.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
      <div class="event-tag">${meeting.type || '–í–°–¢–†–ï–ß–ê'}</div>
      <div class="event-date">${formatDate(meeting.date)}</div>
      <div class="event-location" style="
        margin-top: 8px;
        font-size: 14px;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 4px;
      ">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z"/>
        </svg>
        ${meeting.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ'}
      </div>
      ${meeting.age_limit ? `
      <div class="age-limit" style="
        margin-top: 4px;
        font-size: 12px;
        color: #ef4444;
        font-weight: 500;
      ">
        ${meeting.age_limit}+
      </div>
      ` : ''}
    </div>
  `;

      if (!isCompleted) {
        div.addEventListener('click', () => showMeetingModal(meeting));
        div.querySelector('.favorite').addEventListener('click', (e) => {
          e.stopPropagation();
          toggleFavorite(div.querySelector('.favorite'));
        });
      } else {
        div.style.opacity = '0.7';
        div.style.cursor = 'not-allowed';
      }

      return div;
    }

    function showMeetingModal(meeting) {
      const modal = document.getElementById('meetingModal');
      const isCompleted = meeting.status === 0;

      // –ó–∞–ø–æ–ª–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º description –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–æ–∫
      document.getElementById('meetingModalTitle').textContent = meeting.description || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
      document.getElementById('meetingModalDate').textContent = formatDate(meeting.date);
      document.getElementById('meetingModalLocation').textContent = meeting.location || '–ú–µ—Å—Ç–æ –Ω–µ —É–∫–∞–∑–∞–Ω–æ';
      document.getElementById('meetingModalAgeLimit').textContent = meeting.age_limit ? `${meeting.age_limit}+` : '–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π';
      document.getElementById('meetingModalDescription').textContent = meeting.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
      document.getElementById('meetingModalType').textContent = meeting.type || '–í–°–¢–†–ï–ß–ê';
      //document.getElementById('meetingModalStatus').textContent = isCompleted ? '–ó–ê–í–ï–†–®–ï–ù–û' : '–ê–ö–¢–ò–í–ù–û';
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º visit_count –≤–º–µ—Å—Ç–æ attendees_count
      document.getElementById('meetingAttendeesCount').textContent = meeting.visit_count || 0;

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      const modalImage = document.getElementById('meetingModalImage');
      modalImage.src = meeting.image_url || 'https://via.placeholder.com/600x300/333/666?text=–í—Å—Ç—Ä–µ—á–∞';
      modalImage.alt = meeting.description || '–í—Å—Ç—Ä–µ—á–∞';

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ –∫–∞—Ä—Ç—ã
      const mapBtn = document.getElementById('meetingMapBtn');
      if (meeting.map_link) {
        mapBtn.style.display = 'flex';
        mapBtn.onclick = () => window.open(meeting.map_link, '_blank');
      } else {
        mapBtn.style.display = 'none';
      }

      // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ —É—á–∞—Å—Ç–∏—è
      const attendBtn = document.getElementById('meetingAttendBtn');
      if (isCompleted) {
        attendBtn.textContent = '–í—Å—Ç—Ä–µ—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
        attendBtn.disabled = true;
        attendBtn.classList.add('btn-disabled');
      } else {
        attendBtn.textContent = '–Ø –ø–æ–π–¥—É!';
        attendBtn.disabled = false;
        attendBtn.classList.remove('btn-disabled');
        attendBtn.onclick = () => attendMeeting(meeting.meet_token); // –∏—Å–ø–æ–ª—å–∑—É–µ–º meet_token –≤–º–µ—Å—Ç–æ id
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      modal.style.display = 'block';
    }


    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —É—á–∞—Å—Ç–∏—è –≤–æ –≤—Å—Ç—Ä–µ—á–µ
    function attendMeeting(meetingId) {
      // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ —É—á–∞—Å—Ç–∏—è –≤–æ –≤—Å—Ç—Ä–µ—á–µ
      console.log('–£—á–∞—Å—Ç–∏–µ –≤–æ –≤—Å—Ç—Ä–µ—á–µ:', meetingId);
      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Ç.–¥.
    }

    function createAdCard(ad) {
      const div = document.createElement('div');
      div.className = 'ad-card';
      div.innerHTML = `
        <div class="ad-badge">–†–ï–ö–õ–ê–ú–ê</div>
        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">${ad.title}</h3>
        <p style="color: #ccc; font-size: 14px; margin-bottom: 8px;">${ad.description || ''}</p>
        <p style="color: #ff00cc; font-size: 12px; font-weight: 600;">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</p>
      `;

      div.addEventListener('click', () => showAdModal(ad));
      return div;
    }

    async function loadEventAttendees(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/visitCount/?event_id=${eventId}`);
        if (response.ok) {
          const data = await response.json();
          document.getElementById('eventAttendeesCount').textContent = data.count || 0;
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);
      }

      try {
        const response = await fetch(`${BACKEND_URL}/v1/event/check/${eventId}/${user.id}`);
        if (response.ok) {
          const data = await response.json();
          const attendBtn = document.getElementById('eventAttendBtn');
          if (data.is_attending) {
            attendBtn.textContent = '–ù–µ –ø–æ–π–¥—É';
            attendBtn.className = 'btn btn-secondary';
            attendBtn.onclick = () => unattendEvent(eventId);
          } else {
            attendBtn.textContent = '–Ø –ø–æ–π–¥—É!';
            attendBtn.className = 'btn btn-primary';
            attendBtn.onclick = () => attendEvent(eventId);
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–∏—è:', error);
      }
    }

    async function attendEvent(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/attend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event_id: eventId, user_id: user.id })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            updateLocalEventData(eventId, 1);
            alert('–û—Ç–ª–∏—á–Ω–æ! –í—ã –∏–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!');
          } else {
            alert('–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!');
          }
          await checkUserAttendance(eventId);
        }
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
      }
    }

    async function unattendEvent(eventId) {
      if (!confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –ø–æ–π–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')) return;

      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/unattend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event_id: eventId, user_id: user.id })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success || result === true) {
            updateLocalEventData(eventId, -1);
            await checkUserAttendance(eventId);
            alert('–í—ã –±–æ–ª—å—à–µ –Ω–µ –∏–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
          }
        }
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏');
      }
    }

    function updateLocalEventData(eventId, change) {
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –º–∞—Å—Å–∏–≤–µ
      const eventIndex = currentEvents.findIndex(e => e.id === eventId);
      if (eventIndex !== -1) {
        currentEvents[eventIndex].attendees_count = (currentEvents[eventIndex].attendees_count || 0) + change;
      }
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
      if (currentEvent && currentEvent.id === eventId) {
        currentEvent.attendees_count = (currentEvent.attendees_count || 0) + change;
        document.getElementById('eventAttendeesCount').textContent = currentEvent.attendees_count;
      }

      // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
      if (currentSection === 'events-section') {
        renderEventsContent();
      }
    }


    function showVotingModal(voting) {
      currentVoting = voting;

      document.getElementById('votingModalTitle').textContent = voting.title;
      document.getElementById('votingModalDescription').textContent = voting.description || '';

      document.getElementById('votingLocationSection').style.display = 'block';
      document.getElementById('votingOptions').style.display = 'none';
      document.getElementById('votingResults').style.display = 'none';
      document.getElementById('getLocationBtn').textContent = '–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
      document.getElementById('getLocationBtn').className = 'btn btn-primary';

      checkVotingStatus(voting.id);

      document.getElementById('votingModal').classList.add('active');
      tg.BackButton.show();
      tg.BackButton.onClick(() => closeModal('votingModal'));
    }

    async function checkVotingStatus(votingId) {
      try {
        const response = await fetch(`${BACKEND_URL}/index.php?action=getUserVote&voting_id=${votingId}&user_id=${user.id}`);
        if (response.ok) {
          const data = await response.json();
          if (data.vote_params_id || currentVoting.status === 'completed') {
            showVotingResults();
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
      }
    }

    document.getElementById('getLocationBtn').addEventListener('click', function () {
      if (!navigator.geolocation) {
        alert('–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º');
        return;
      }

      this.textContent = '–û–ø—Ä–µ–¥–µ–ª—è–µ–º...';
      this.disabled = true;

      navigator.geolocation.getCurrentPosition(
        async (position) => {
          userLocation = {
            latitude: position.coords.latitude,
            longitude: position.coords.longitude
          };

          this.textContent = '–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ!';
          this.className = 'btn btn-secondary';

          await loadVotingOptions();
        },
        (error) => {
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ');
          this.textContent = '–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
          this.disabled = false;
        }
      );
    });

    async function loadVotingOptions() {
      try {
        const response = await fetch(`${BACKEND_URL}/index.php?action=getVoteParams&voting_id=${currentVoting.id}`);
        if (response.ok) {
          const options = await response.json();
          const optionsList = document.getElementById('votingOptionsList');
          optionsList.innerHTML = '';

          options.forEach(option => {
            const optionDiv = document.createElement('div');
            optionDiv.className = 'voting-option';
            optionDiv.style.cssText = 'background: #2a2a2a; padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer;';
            optionDiv.innerHTML = `
              <div style="display: flex; justify-content: between; align-items: center;">
                <span>${option.title}</span>
                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;" 
                        onclick="castVote(${option.id})">–ì–æ–ª–æ—Å–æ–≤–∞—Ç—å</button>
              </div>
              ${option.image_url ? `<img src="${option.image_url}" style="max-width: 100px; margin-top: 8px; border-radius: 4px;">` : ''}
            `;
            optionsList.appendChild(optionDiv);
          });

          document.getElementById('votingLocationSection').style.display = 'none';
          document.getElementById('votingOptions').style.display = 'block';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:', error);
      }
    }

    async function castVote(voteParamId) {
      try {
        const response = await fetch(`${BACKEND_URL}/index.php?action=submitVote`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            voting_id: currentVoting.id,
            vote_params_id: voteParamId,
            user_id: user.id
          })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            alert('–í–∞—à –≥–æ–ª–æ—Å —É—á—Ç–µ–Ω!');
            showVotingResults();
          } else {
            alert(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
          }
        }
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
      }
    }

    async function showVotingResults() {
      try {
        const response = await fetch(`${BACKEND_URL}/index.php?action=getVoteParams&voting_id=${currentVoting.id}`);
        if (response.ok) {
          const options = await response.json();
          const resultsList = document.getElementById('votingResultsList');
          resultsList.innerHTML = '';

          options.forEach(option => {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'voting-result';
            resultDiv.style.cssText = 'background: #2a2a2a; padding: 12px; border-radius: 8px; margin-bottom: 8px;';
            resultDiv.innerHTML = `
              <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 8px;">
                <span>${option.title}</span>
                <span style="color: #00ffcc; font-weight: 600;">${option.vote_count || 0} –≥–æ–ª–æ—Å–æ–≤</span>
              </div>
              ${option.image_url ? `<img src="${option.image_url}" style="max-width: 100px; border-radius: 4px;">` : ''}
            `;
            resultsList.appendChild(resultDiv);
          });

          document.getElementById('votingLocationSection').style.display = 'none';
          document.getElementById('votingOptions').style.display = 'none';
          document.getElementById('votingResults').style.display = 'block';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
      }
    }

    async function showEventModal(event) {
      currentEvent = event;
      const attendeesCount = event.attendees_count || 0;

      document.getElementById('eventModalTitle').textContent = event.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
      document.getElementById('eventModalDate').textContent = formatDate(event.date);
      document.getElementById('eventModalLocation').textContent = event.location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
      document.getElementById('eventModalDescription').textContent = event.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
      document.getElementById('eventModalImage').src = event.image_url || 'https://via.placeholder.com/400x200/333/666?text=–°–æ–±—ã—Ç–∏–µ';

      const mapBtn = document.getElementById('eventMapBtn');
      if (event.map_link) {
        mapBtn.style.display = 'block';
        mapBtn.onclick = () => tg.openLink(event.map_link);
      } else {
        mapBtn.style.display = 'none';
      }

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      document.getElementById('eventAttendeesCount').textContent = attendeesCount;
      await checkUserAttendance(event.id);

      document.getElementById('eventModal').classList.add('active');
      tg.BackButton.show();
      tg.BackButton.onClick(() => closeModal('eventModal'));
    }

    async function checkUserAttendance(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/check/${eventId}/${user.id}`);
        if (response.ok) {
          const data = await response.json();
          const attendBtn = document.getElementById('eventAttendBtn');

          if (data.is_attending) {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —É—á–∞—Å—Ç–≤—É–µ—Ç
            attendBtn.textContent = '–ù–µ –ø–æ–π–¥—É';
            attendBtn.className = 'btn btn-secondary';
            attendBtn.onclick = () => unattendEvent(eventId);
          } else {
            // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç
            attendBtn.textContent = '–Ø –ø–æ–π–¥—É!';
            attendBtn.className = 'btn btn-primary';
            attendBtn.onclick = () => attendEvent(eventId);
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—á–∞—Å—Ç–∏—è:', error);
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–Ø –ø–æ–π–¥—É!"
        const attendBtn = document.getElementById('eventAttendBtn');
        attendBtn.textContent = '–Ø –ø–æ–π–¥—É!';
        attendBtn.className = 'btn btn-primary';
        attendBtn.onclick = () => attendEvent(eventId);
      }
    }

    async function loadEventAttendees(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/visitCount/${eventId}`);
        if (response.ok) {
          const data = await response.json();
          // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–ª—é—á –∏–∑ –≤–∞—à–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
          const count = data["count"] || data.count || 0;
          document.getElementById('eventAttendeesCount').textContent = count;

          // –¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
          updateEventCardBadge(eventId, count);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);
        document.getElementById('eventAttendeesCount').textContent = '0';
      }
    }

    function updateEventCardBadge(eventId, count) {
      // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —ç—Ç–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂
      const eventCards = document.querySelectorAll('.event-card');
      eventCards.forEach(card => {
        const eventTitle = card.querySelector('.event-title')?.textContent;
        if (eventTitle === currentEvent?.title) {
          const attendeesBadge = card.querySelector('.attendees-badge');
          if (attendeesBadge) {
            attendeesBadge.textContent = `${count} –∏–¥—É—Ç`;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            if (count === 0) {
              attendeesBadge.style.background = 'rgba(255, 255, 255, 0.3)';
              attendeesBadge.style.color = '#fff';
            } else if (count < 5) {
              attendeesBadge.style.background = 'rgba(0, 255, 204, 0.9)';
              attendeesBadge.style.color = '#000';
            } else if (count < 15) {
              attendeesBadge.style.background = 'rgba(255, 152, 0, 0.9)';
              attendeesBadge.style.color = '#000';
            } else {
              attendeesBadge.style.background = 'rgba(233, 30, 99, 0.9)';
              attendeesBadge.style.color = '#fff';
            }
          }
        }
      });
    }

    async function attendEvent(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/attend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event_id: eventId, user_id: user.id })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            await loadEventAttendees(eventId);
            await checkUserAttendance(eventId);
            alert('–û—Ç–ª–∏—á–Ω–æ! –í—ã –∏–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!');
          } else {
            alert('–í—ã —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ —ç—Ç–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ!');
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
            await checkUserAttendance(eventId);
          }
        } else {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏');
        }
      } catch (error) {
        console.error('Attend error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
      }
    }

    async function unattendEvent(eventId) {
      if (!confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ –ø–æ–π–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ?')) return;

      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/unattend`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event_id: eventId, user_id: user.id })
        });

        if (response.ok) {
          const result = await response.json();
          if (result.success || result === true) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            await loadEventAttendees(eventId);
            await checkUserAttendance(eventId);
            alert('–í—ã –±–æ–ª—å—à–µ –Ω–µ –∏–¥–µ—Ç–µ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ');
          } else {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å');
          }
        } else {
          throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏');
        }
      } catch (error) {
        console.error('Unattend error:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–ø–∏—Å–∏');
      }
    }

    document.querySelector('button[data-filter="–í—Å—Ç—Ä–µ—á–∏"]').addEventListener('click', function () {
      filterEventsByType('–í—Å—Ç—Ä–µ—á–∏');
    });

    function filterEventsByType(type) {
      const events = document.querySelectorAll('.event-card'); // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –∏–º–µ—é—Ç –∫–ª–∞—Å—Å event-card

      events.forEach(event => {
        const eventType = event.getAttribute('data-type') || event.querySelector('.event-type')?.textContent;

        if (type === 'all' || eventType === type) {
          event.style.display = 'block';
        } else {
          event.style.display = 'none';
        }
      });

      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–∞
      document.querySelectorAll('[data-filter]').forEach(btn => {
        btn.classList.remove('active');
      });
      this.classList.add('active');
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.getElementById(modalId).classList.remove('active');
      tg.BackButton.hide();
    }

    function toggleFavorite(element) {
      element.classList.toggle('active');
    }

    function formatDate(dateStr) {
      if (!dateStr) return '–ë–µ–∑ –¥–∞—Ç—ã';
      const months = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
      const date = new Date(dateStr);
      return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()}`;
    }

    // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    async function loadEventAttendeesCount(eventId) {
      try {
        const response = await fetch(`${BACKEND_URL}/api/v1/event/visitCount/${eventId}`);
        if (response.ok) {
          const data = await response.json();
          return data['count'] || 0;
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', error);
      }
      return 0;
    }

    function showServerError() {
      const container = document.getElementById(currentSection === 'events-section' ? 'events-container' : 'meetings-container');
      container.innerHTML = `
        <div style="text-align: center; padding: 40px 20px;">
        <img src="${BACKEND_URL}/images/SERVERWORKS.gif" 
                             alt="–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã" 
                             class="mx-auto mb-4 w-32 h-32 object-contain rounded-lg">
          <div style="font-size: 48px; margin-bottom: 16px;">üöß</div>
          <h3 style="margin-bottom: 8px; color: #fff;">${serverStatusMessage || '–í–µ–¥—É—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã'}</h3>
          <p style="color: #888; margin-bottom: 20px;">–ú—ã —É–ª—É—á—à–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –≤–∞—à–µ–≥–æ —É–¥–æ–±—Å—Ç–≤–∞.<br>–°–∫–æ—Ä–æ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç!</p>
          <button class="btn btn-primary" onclick="location.reload()">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
      `;
    }
  </script>
</body>

</html>